# Handwritten-OCR-5-LLM ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰

å»ºç¯‰å›³é¢ã®æ‰‹æ›¸ãæŒ‡æ‘˜äº‹é …ã‚’è‡ªå‹•æŠ½å‡ºã™ã‚‹OCRã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚OpenAI o3ã¨Google Geminiã®2ã¤ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

## ðŸ“‹ å‰ææ¡ä»¶

æœ¬ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ãŒå¿…è¦ã§ã™ï¼š

- **Node.js**: v20ä»¥ä¸Š
- **pnpm**: v10ä»¥ä¸Šï¼ˆ`npm install -g pnpm`ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼‰
- **APIã‚­ãƒ¼**: 
  - **OpenAI API Key**ï¼ˆo3ç”¨ï¼‰: [OpenAI Platform](https://platform.openai.com/api-keys)ã‹ã‚‰å–å¾—
  - **Google Cloud Service Account**ï¼ˆGeminiç”¨ï¼‰: [è¨­å®šã‚¬ã‚¤ãƒ‰](https://cloud.google.com/iam/docs/keys-create-delete)å‚ç…§

> âš ï¸ **APIåˆ©ç”¨æ–™é‡‘ã«ã¤ã„ã¦**  
> æœ¬ã‚·ã‚¹ãƒ†ãƒ ã®åˆ©ç”¨ã«ã¯ã€OpenAIã¾ãŸã¯Google Cloudã®APIåˆ©ç”¨æ–™é‡‘ãŒç™ºç”Ÿã—ã¾ã™ã€‚å„ã‚µãƒ¼ãƒ“ã‚¹ã®æ–™é‡‘ä½“ç³»ã‚’äº‹å‰ã«ã”ç¢ºèªãã ã•ã„ã€‚

## ðŸš€ 5åˆ†ã§ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¯ãƒ­ãƒ¼ãƒ³ã¨åˆæœŸè¨­å®š

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/GRI-Inc/handwritten-ocr-5-llm.git
cd handwritten-ocr-5-llm

# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆpnpmå¿…é ˆï¼‰
pnpm install

# å…¥å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®åˆæœŸåŒ–
# (handwritten-input ã¨ handwritten-output ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™)
pnpm init
```

### 2. ç’°å¢ƒè¨­å®šï¼ˆ.envãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ï¼š

```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
touch .env

# ã‚¨ãƒ‡ã‚£ã‚¿ã§é–‹ãï¼ˆä¾‹ï¼šnanoï¼‰
nano .env
```

ä»¥ä¸‹ã®å†…å®¹ã‚’è¨˜å…¥ã—ã¦ä¿å­˜ï¼š

```bash
# OpenAIï¼ˆo3ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ç”¨ï¼‰
OPENAI_API_KEY=your-openai-api-key

# Google Cloudï¼ˆGeminiãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ç”¨ï¼‰
# ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã€Œçµ¶å¯¾ãƒ‘ã‚¹ã€ã‚’æŒ‡å®š
GOOGLE_SERVICE_ACCOUNT_JSON=/path/to/your-service-account.json
```

ã¾ãŸã¯ã€ã‚³ãƒžãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ç›´æŽ¥ä½œæˆï¼š

```bash
cat > .env << EOF
OPENAI_API_KEY=your-openai-api-key
GOOGLE_SERVICE_ACCOUNT_JSON=/path/to/your-service-account.json
EOF
```

### 3. ç”»åƒã‚’å‡¦ç†ã™ã‚‹

å¯¾å¿œãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ: PNG, JPEG, GIF, WEBP

```bash
# 1. ç”»åƒã‚’inputãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®
cp your-drawing.png handwritten-input/

# ã¾ãŸã¯æ—¢å­˜ã®ã‚µãƒ³ãƒ—ãƒ«ç”»åƒã§è©¦ã™å ´åˆï¼ˆã™ã§ã«é…ç½®æ¸ˆã¿ï¼‰:
# - çŸ³é»’ãƒã‚§ãƒƒã‚¯å›³_page_1.png
# - 220111_æ¾é¢¨åŽšç”Ÿæ£Ÿ_è¨­è¨ˆæ¤œè¨¼æ¤œå›³QAã€å¡©è¦‹ã€‘ãƒã‚§ãƒƒã‚¯å›³_page_11.png

# 2. å‡¦ç†å®Ÿè¡Œï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: o3ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼‰
pnpm process

# 3. çµæžœã‚’ç¢ºèª
cat handwritten-output/çŸ³é»’ãƒã‚§ãƒƒã‚¯å›³_page_1_o3_o3.txt

# ã¾ãŸã¯ Geminiãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’ä½¿ç”¨
# (-- ã¯pnpmã‹ã‚‰å†…éƒ¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«å¼•æ•°ã‚’æ¸¡ã™ãŸã‚ã®åŒºåˆ‡ã‚Š)
pnpm process -- --provider gemini

# Geminiã®çµæžœã‚’ç¢ºèª
cat handwritten-output/çŸ³é»’ãƒã‚§ãƒƒã‚¯å›³_page_1_gemini_gemini-2.5-pro.txt
```

## ðŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
llm-ocr/
â”œâ”€â”€ handwritten-input/      # ðŸ–¼ï¸ å‡¦ç†ã™ã‚‹ç”»åƒã‚’ã“ã“ã«é…ç½®
â”œâ”€â”€ handwritten-output/     # ðŸ“„ å‡¦ç†çµæžœãŒå‡ºåŠ›ã•ã‚Œã‚‹
â”‚   â”œâ”€â”€ {ç”»åƒå}_{ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼}_{ãƒ¢ãƒ‡ãƒ«}.txt
â”‚   â””â”€â”€ process.log
â”œâ”€â”€ packages/               # ãƒ¢ãƒŽãƒ¬ãƒæ§‹æˆ
â”‚   â”œâ”€â”€ cli/               # CLIãƒ„ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ core/              # å…±é€šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”œâ”€â”€ o3/                # OpenAI o3ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼
â”‚   â””â”€â”€ gemini/            # Google Geminiãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼
â””â”€â”€ .env                   # ç’°å¢ƒå¤‰æ•°ï¼ˆè¦ä½œæˆï¼‰
```

### å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åã®è¦å‰‡
- `{ç”»åƒå}_{ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼}_{ãƒ¢ãƒ‡ãƒ«}.txt`
- ä¾‹: `drawing_o3_o3.txt`, `drawing_gemini_gemini-2.5-pro.txt`

## ðŸŽ® ã‚³ãƒžãƒ³ãƒ‰ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### åŸºæœ¬ã‚³ãƒžãƒ³ãƒ‰

```bash
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåˆæœŸåŒ–
pnpm init

# ç”»åƒå‡¦ç†ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šï¼‰
pnpm process

# ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’æŒ‡å®š
pnpm process -- --provider gemini

# ãƒ¢ãƒ‡ãƒ«ã‚’æŒ‡å®šï¼ˆGeminiç”¨ï¼‰
pnpm process -- --provider gemini --model gemini-2.5-flash

# æœ€å¤§ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã‚’å¤‰æ›´
pnpm process -- --max-tokens 15000

# ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½¿ç”¨
pnpm process -- --prompt "æŒ‡æ‘˜äº‹é …ã‚’è©³ç´°ã«æŠ½å‡ºã—ã¦ãã ã•ã„"
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä¸€è¦§

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜Ž | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | ä¾‹ |
|-----------|------|-----------|-----|
| `-p, --provider` | OCRãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ | `o3` | `gemini`, `o3` |
| `--model` | ä½¿ç”¨ãƒ¢ãƒ‡ãƒ« | ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ä¾å­˜ | `gemini-2.5-flash` |
| `--max-tokens` | æœ€å¤§ãƒˆãƒ¼ã‚¯ãƒ³æ•° | `10000` | `15000` |
| `--prompt` | ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ | çµ„ã¿è¾¼ã¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ | ä»»æ„ã®ãƒ†ã‚­ã‚¹ãƒˆ |


## ðŸ’¡ ä½¿ç”¨ä¾‹

### ä¾‹1: è¤‡æ•°ç”»åƒã®ä¸€æ‹¬å‡¦ç†

```bash
# è¤‡æ•°ã®ç”»åƒã‚’inputãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®
cp drawings/*.png handwritten-input/

# å…¨ç”»åƒã‚’å‡¦ç†ï¼ˆ3ä¸¦åˆ—ã§å®Ÿè¡Œï¼‰
pnpm process

# å‡¦ç†çµæžœã‚’ç¢ºèª
ls -la handwritten-output/
```

### ä¾‹2: ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æ¯”è¼ƒ

```bash
# o3ã§å‡¦ç†
pnpm process

# ç¶šã‘ã¦Geminiã§å‡¦ç†
pnpm process -- --provider gemini

# outputãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§çµæžœã‚’æ¯”è¼ƒ
ls -la handwritten-output/

# çµæžœã®å·®åˆ†ã‚’ç¢ºèªï¼ˆä¾‹ï¼‰
diff handwritten-output/drawing_o3_o3.txt handwritten-output/drawing_gemini_gemini-2.5-pro.txt
```

### ä¾‹3: é«˜é€Ÿå‡¦ç†ï¼ˆGemini Flashï¼‰

```bash
pnpm process -- --provider gemini --model gemini-2.5-flash
```

## ðŸ“Š å‡ºåŠ›å½¢å¼

å‡¦ç†çµæžœã¯ä»¥ä¸‹ã®å½¢å¼ã§å‡ºåŠ›ã•ã‚Œã¾ã™ï¼š

```
========== å›³é¢æƒ…å ± ==========
å›³é¢åç§°ï¼šç©ºèª¿è¨­å‚™ 1ãƒ»2éšŽå¹³é¢å›³
å›³é¢ç•ªå·ï¼šM-04
å›³é¢ç¨®åˆ¥ï¼šè¨­å‚™å›³
å»ºç‰©ç¨®åˆ¥ï¼š(not visible)
ç¸®å°ºï¼šA1=1:200 / A3=1:400
æ—¥ä»˜ï¼š2024-02-16

========== æŒ‡æ‘˜äº‹é … ==========
â– æŒ‡æ‘˜1
æ‰‹æ›¸ãå†…å®¹ï¼š
å´æºãŒæ¨ªæ–­ã—ã¦ã„ã‚‹ãŒå•é¡Œãªã„ã‹ï¼Ÿ
æŒ‡æ‘˜å¯¾è±¡ï¼š
ãƒˆãƒ©ãƒƒã‚¯ãƒ¤ãƒ¼ãƒ‰å‡ºå…¥å£ã¨å–«ç…™å®¤ã®é–“ã®å´æº
æ–‡è„ˆæƒ…å ±ï¼š
ãƒˆãƒ©ãƒƒã‚¯ãƒ¤ãƒ¼ãƒ‰å‡ºå…¥å£ã¨å–«ç…™å®¤ã®é–“ã‚’æ¨ªåˆ‡ã‚‹å´æºã‚’æŒ‡ã—ã¦ãŠã‚Š...
```

## ðŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **`pnpm: command not found`**
   ```bash
   npm install -g pnpm
   ```

2. **APIã‚­ãƒ¼ã‚¨ãƒ©ãƒ¼**
   - `.env`ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   - ãƒ‘ã‚¹ã¯çµ¶å¯¾ãƒ‘ã‚¹ã§æŒ‡å®š

3. **ç”»åƒãŒå‡¦ç†ã•ã‚Œãªã„**
   - å¯¾å¿œå½¢å¼: PNG, JPG, JPEG, GIF, WEBP
   - ãƒ•ã‚¡ã‚¤ãƒ«åã«ç‰¹æ®Šæ–‡å­—ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ç¢ºèª
   - `handwritten-input/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æ­£ã—ãé…ç½®ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

4. **Geminiã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**
   ```bash
   # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’å»¶é•·
   pnpm process -- --provider gemini --max-tokens 20000
   ```

## ðŸ”„ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ›´æ–°

```bash
# æœ€æ–°ç‰ˆã‚’å–å¾—
git pull origin main

# ä¾å­˜é–¢ä¿‚ã‚’æ›´æ–°
pnpm install
```

## ðŸ“š ã•ã‚‰ã«è©³ã—ã

- **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚º**: `/packages/cli/src/handwritten-analyzer.ts`ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å‚ç…§
- **æ–°ã—ã„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®è¿½åŠ **: `/packages/core/src/types.ts`ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…
- **ãƒãƒƒãƒå‡¦ç†ã®ä¸¦åˆ—åŒ–**: ç¾åœ¨ã¯3ä¸¦åˆ—ã§å‡¦ç†ï¼ˆ`CONCURRENT_LIMIT`ï¼‰

## ðŸ¤ è²¢çŒ®

1. Forkã™ã‚‹
2. Feature branchã‚’ä½œæˆ (`git checkout -b feature/amazing-feature`)
3. ã‚³ãƒŸãƒƒãƒˆ (`git commit -m 'Add amazing feature'`)
4. Push (`git push origin feature/amazing-feature`)
5. Pull Requestã‚’é–‹ã

## ðŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License - è©³ç´°ã¯[LICENSE](LICENSE)ã‚’å‚ç…§