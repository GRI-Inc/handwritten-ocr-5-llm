# Handwritten OCR System v5 with o3 Model

å»ºç¯‰å›³é¢PDFã‹ã‚‰æ‰‹æ›¸ãã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ½å‡ºãƒ»åˆ†æã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚OpenAI o3 ãƒ¢ãƒ‡ãƒ«ï¼ˆæ¨è«–ç‰¹åŒ–å‹ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€æ‰‹æ›¸ãã®ã‚³ãƒ¡ãƒ³ãƒˆã‚„ãƒ¡ãƒ¢ã‚’è­˜åˆ¥ã—ã€ãã®ä½ç½®ã€å†…å®¹ã€æ–‡è„ˆã‚’è§£æã—ã¾ã™ã€‚

## æ©Ÿèƒ½

- ğŸ“„ PDFãƒ•ã‚¡ã‚¤ãƒ«ã®å„ãƒšãƒ¼ã‚¸ã‚’ç”»åƒã«å¤‰æ›
- ğŸ” o3 ãƒ¢ãƒ‡ãƒ«ï¼ˆæ¨è«–ç‰¹åŒ–å‹ï¼‰ã«ã‚ˆã‚‹æ‰‹æ›¸ãã‚³ãƒ¡ãƒ³ãƒˆã®æ¤œå‡º
- ğŸ“ ã‚³ãƒ¡ãƒ³ãƒˆã®ä½ç½®æƒ…å ±ï¼ˆãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ï¼‰ã®å–å¾—
- ğŸ—ï¸ å»ºç¯‰å›³é¢ã®è¦ç´ ã¨ã®é–¢é€£ä»˜ã‘
- ğŸ“Š çµæœã‚’ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã§è¡¨ç¤º
- ğŸ’¾ CSV/JSONå½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
pnpm install
```

### 2. OpenAI APIã‚­ãƒ¼ã®è¨­å®š

`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€APIã‚­ãƒ¼ã‚’è¨­å®šï¼š

```bash
OPENAI_API_KEY=your-api-key-here
```

## ä½¿ç”¨æ–¹æ³•

### PDFãƒ•ã‚¡ã‚¤ãƒ«åˆ†æ

åŸºæœ¬çš„ãªä½¿ã„æ–¹

```bash
# PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†æ
pnpm analyze <pdf-file>

# ä¾‹ï¼š
pnpm analyze "samples/çŸ³é»’ãƒ¡ãƒ¢.pdf"
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³

```bash
# CSVå½¢å¼ã§å‡ºåŠ›ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: results/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ï¼‰
pnpm analyze "samples/çŸ³é»’ãƒ¡ãƒ¢.pdf" -o results/output.csv

# JSONå½¢å¼ã§å‡ºåŠ›
pnpm analyze "samples/çŸ³é»’ãƒ¡ãƒ¢.pdf" -j results/output.json

# ä¸¡æ–¹ã®å½¢å¼ã§å‡ºåŠ›
pnpm analyze "samples/çŸ³é»’ãƒ¡ãƒ¢.pdf" -o results/output.csv -j results/output.json

# APIã‚­ãƒ¼ã‚’ç›´æ¥æŒ‡å®š
pnpm analyze "samples/çŸ³é»’ãƒ¡ãƒ¢.pdf" --api-key sk-xxx
```

### ç”»åƒè§£æCLIãƒ„ãƒ¼ãƒ«ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãƒ¢ãƒ¼ãƒ‰ï¼‰

PDFã§ã¯ãªãã€ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥ãƒãƒƒãƒå‡¦ç†ã—ãŸã„å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚·ãƒ³ãƒ—ãƒ«ãªCLIãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

#### 1. åˆæœŸåŒ–

```bash
# å…¥å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
npx tsx src/cli.ts handwritten:init
```

ã“ã‚Œã«ã‚ˆã‚Šä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã¾ã™ï¼š
- `handwritten-input/` - ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
- `handwritten-output/` - è§£æçµæœãŒå‡ºåŠ›ã•ã‚Œã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

#### 2. ç”»åƒã®é…ç½®

`handwritten-input/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è§£æã—ãŸã„ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã—ã¾ã™ã€‚
ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹å½¢å¼: `.png`, `.jpg`, `.jpeg`, `.gif`, `.webp`

#### 3. ãƒãƒƒãƒå‡¦ç†ã®å®Ÿè¡Œ

```bash
# ã™ã¹ã¦ã®ç”»åƒã‚’å‡¦ç†
npx tsx src/cli.ts handwritten:process

# ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã‚’æŒ‡å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10000ï¼‰
npx tsx src/cli.ts handwritten:process --max-tokens 20000
```

#### 4. çµæœã®ç¢ºèª

- å„ç”»åƒã®è§£æçµæœã¯ `handwritten-output/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `.txt` ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã•ã‚Œã¾ã™
- å‡¦ç†ãƒ­ã‚°ã¯ `handwritten-output/process-log-[timestamp].json` ã¨ã—ã¦ä¿å­˜ã•ã‚Œã¾ã™

#### ä½¿ç”¨ä¾‹

```bash
# ã‚¹ãƒ†ãƒƒãƒ—1: åˆæœŸåŒ–
npx tsx src/cli.ts handwritten:init

# ã‚¹ãƒ†ãƒƒãƒ—2: ç”»åƒã‚’é…ç½®
cp my-images/*.png handwritten-input/

# ã‚¹ãƒ†ãƒƒãƒ—3: å‡¦ç†å®Ÿè¡Œ
npx tsx src/cli.ts handwritten:process

# ã‚¹ãƒ†ãƒƒãƒ—4: çµæœç¢ºèª
ls handwritten-output/
# image1.txt
# image2.txt
# process-log-2025-07-02T08-58-50-382Z.json
```

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
handwritten-ocr-5-o3/
â”œâ”€â”€ samples/                # ã‚µãƒ³ãƒ—ãƒ«PDFãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ *.pdf
â”œâ”€â”€ results/                # åˆ†æçµæœãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆgitignoreå¯¾è±¡ï¼‰
â”‚   â”œâ”€â”€ *.csv
â”‚   â””â”€â”€ *.json
â”œâ”€â”€ handwritten-input/      # ç”»åƒè§£æç”¨å…¥åŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚   â””â”€â”€ *.png, *.jpg, etc.
â”œâ”€â”€ handwritten-output/     # ç”»åƒè§£æçµæœå‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚   â”œâ”€â”€ *.txt
â”‚   â””â”€â”€ process-log-*.json
â”œâ”€â”€ vision-module/          # ç”»åƒè§£æã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”œâ”€â”€ src/                    # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ cli.ts
â”‚   â”œâ”€â”€ handwritten-analyzer.ts
â”‚   â””â”€â”€ ...
â””â”€â”€ README.md
```

## å‡ºåŠ›å½¢å¼

### JSONå‡ºåŠ›ã‚¹ã‚­ãƒ¼ãƒ

```json
{
  "document_id": "çŸ³é»’ãƒ¡ãƒ¢.pdf",
  "pages": [
    {
      "page": 1,
      "comments": [
        {
          "id": "C1",
          "bbox_norm": { "x": 0.12, "y": 0.05, "w": 0.30, "h": 0.08 },
          "comment_text": "éšæ®µã¨å¤–å£ã®ã™ãé–“ï¼Ÿç¢ºèªæ¸ˆï¼Ÿ",
          "context_note": "éšæ®µè¸Šã‚Šå ´å´â€¦å¹²æ¸‰ã‚„è€ç«å¡ãå¿˜ã‚Œã®æ‡¸å¿µ",
          "related_elements": ["stair", "outer_wall"],
          "severity": "warning",
          "resolved": false,
          "created_at": "2025-06-27T16:15:00+09:00"
        }
      ]
    }
  ]
}
```

### CSVå‡ºåŠ›å½¢å¼

| Document ID | Page | Comment ID | Comment Text | Context Note | Related Elements | Severity | Resolved | X Position | Y Position | Width | Height | Created At |
|------------|------|------------|--------------|--------------|------------------|----------|----------|------------|------------|-------|--------|------------|
| çŸ³é»’ãƒ¡ãƒ¢.pdf | 1 | C1 | éšæ®µã¨å¤–å£ã®ã™ãé–“ï¼Ÿç¢ºèªæ¸ˆï¼Ÿ | éšæ®µè¸Šã‚Šå ´å´â€¦å¹²æ¸‰ã‚„è€ç«å¡ãå¿˜ã‚Œã®æ‡¸å¿µ | stair; outer_wall | warning | false | 0.120 | 0.050 | 0.300 | 0.080 | 2025-06-27T16:15:00+09:00 |

## é–‹ç™º

### ãƒ“ãƒ«ãƒ‰

```bash
# TypeScriptã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
pnpm build
```

### ãƒ†ã‚¹ãƒˆ

```bash
# ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
pnpm test

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆä»˜ã
pnpm test:cov
```

### ãƒªãƒ³ãƒˆ

```bash
# ãƒªãƒ³ãƒˆãƒã‚§ãƒƒã‚¯
pnpm lint

# è‡ªå‹•ä¿®æ­£
pnpm lint:fix
```

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **è¨€èª**: TypeScript
- **å®Ÿè¡Œç’°å¢ƒ**: Node.js
- **PDFå‡¦ç†**: pdf-img-convert
- **AIåˆ†æ**: OpenAI o3ï¼ˆæ¨è«–ç‰¹åŒ–å‹ãƒ¢ãƒ‡ãƒ«ï¼‰
- **CLI**: Commander.js
- **ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º**: cli-table3
- **ãƒ†ã‚¹ãƒˆ**: Vitest

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT